(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{"90cfce":function(e,t,n){},a62e9b:function(e,t,n){"use strict";n.r(t);n("cb1771"),n("578d8d"),n("e28425");var c=n("6ae2af"),o=n("6823ad"),base=n("5989b5"),r=n("b296fc"),l=n("9e4c22"),h=n("7f50c2"),d=n("c0bc28"),f=n("b902cb"),x=n("487109"),m=(n("497371"),"unset"),v={name:"ContextPopupWrapper",props:{showLoader:{type:Boolean,default:!1},searchBarY:{type:[Number,Object,String],default:m,valudator:function(e){return"number"==typeof e||-1!==[m,null].indexOf(e)}},searchBarX:{type:[Number,Object,String],default:m,valudator:function(e){return"number"==typeof e||-1!==[m,null].indexOf(e)}}},computed:{containerX:function(){var e=this.searchBarX;return e!==m&&e?e:null},containerY:function(){var e=this.searchBarY;return e!==m&&e?e-44:null},containerReady:function(){var e=this.containerX,t=this.containerY;return e&&t}}},w=n("f9dfc6"),k=n("b429cb");var y=Object(k.a)(v,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:e.$style["popup-wrapper"]},[n("div",{class:e.$style["popup-mask"],on:{click:function(t){return e.$emit("close")}}}),e._v(" "),n("transition",{attrs:{name:"fade"}},[n("div",{class:e.$style["popup-content-container"],style:{top:e.containerY+"px",left:e.containerX+"px"}},[n("span",{class:e.$style["popup-close"],on:{click:function(t){return e.$emit("close")}}}),e._v(" "),e._t("default")],2)])],1)}),[],!1,(function(e){this.$style=w.default.locals||w.default}),null,null).exports,B=n("ff287e"),C=n.n(B),_=n("301fe4"),S=n("cb4c2a"),I=n.n(S),O=x.a.extend({name:"SearchBarWidget",mixins:[base.a],components:{SearchInput:r.a,Suggestions:l.a,BlockVertical:h.default,TransitionFade:d.a,OzonButton:f.b,OzonIcon:o.a,PopupWrapper:y,PopupRenderer:Object(c.a)("searchBar"),PlaceholderRender:Object(c.a)("block-vertical")},computed:{context:function(){return this.sharedState.searchContext},contextTitle:function(){return this.context?this.context.context_title:""},global:function(){return this.widgetState.global||{link:"/search/?text={value}",placeholder:"Искать на Ozon",suggestion_enabled:!0,is_global:!0}},searchByItems:function(){return C()(this,"widgetState.items.length",0)?this.widgetState.items:[{link:"/search/?text={value}",placeholder:"Искать на Ozon",suggestion_enabled:!0,is_global:!0}]},selectedSearchByItem:function(){return this.context||this.global||this.searchByItems[0]||{}},suggestionsEnabled:function(){var e=this.selectedSearchByItem.suggestion_enabled;return void 0===e||e},widgetName:function(){return(this.trackingInfo||{}).name||""}},data:function(){var e="";try{e=this.calcValue()}catch(e){console.error(e)}return{layoutComponentName:"searchQuery",value:e,inputValue:e,settings:{aClickPrevent:!1},debouncedOnInput:I()(this.onInput,1e3),suggsPlaceholders:{default:[]},isOpen:!1,focusedItem:null,showContextPopup:!1,searchBarX:null,searchBarY:null}},methods:{changeShowContextPopup:function(e){var t=this;if(this.showContextPopup=e,e){if(0!==window.scrollY)Object(_.a)(document.body,{duration:300,callback:function(){var rect=t.$refs.searchBarEl.getBoundingClientRect();t.searchBarX=rect.x,t.searchBarY=rect.y}});else{var rect=this.$refs.searchBarEl.getBoundingClientRect();this.searchBarX=rect.x,this.searchBarY=rect.y}this.$analytics.send("search/openContextPopup",{trackerEvent:{widget:this.widgetName,context:{title:this.contextTitle,link:this.selectedSearchByItem.link},text:this.inputValue}})}else this.searchBarX=null,this.searchBarY=null},disableContext:function(){var e=this.global;this.$analytics.send("search/clearContext",{trackerEvent:{widget:this.widgetName,context:{title:this.selectedSearchByItem.context_title,link:this.selectedSearchByItem.link},text:this.inputValue}}),this.$store.commit("deepSet",{path:"shared.catalog.searchContext",value:e})},onClickSearchBtn:function(e){var t=this.focusedItem,n=this.inputValue;if(t||n&&""!==n)base.a.methods.onClickSearchBtn.call(this,e);else if(this.context&&!this.context.is_global){var c=this.context.link.replace(/text={value}/gi,"").replace(/\?$|&$|\?&$/,"");window.location.assign(c)}},reflectFocusedItem:function(e){this.focusedItem=e}}}),P=(n("c99850"),Object(k.a)(O,(function(){var e=this,t=e.$createElement,c=e._self._c||t;return c("div",{ref:"searchBarEl",staticClass:"search_bar_container",attrs:{"data-test-id":"suggestions-component"}},[c("transition",{attrs:{name:"fade"}},[c("PopupWrapper",{directives:[{name:"show",rawName:"v-show",value:e.showContextPopup,expression:"showContextPopup"},{name:"body-scroll-lock",rawName:"v-body-scroll-lock",value:e.showContextPopup,expression:"showContextPopup"}],attrs:{"search-bar-x":e.searchBarX,"search-bar-y":e.searchBarY},on:{close:function(t){return e.changeShowContextPopup(!1)}}},[c("PopupRenderer",{attrs:{placeholders:e.placeholders,place:"context-popup"},on:{close:function(t){return e.changeShowContextPopup(!1)}}})],1)],1),e._v(" "),c("Suggestions",{staticClass:"search_bar_input_container",attrs:{"default-value":e.value,settings:e.settings},on:{clickItem:e.onClickItem,focusedItem:e.reflectFocusedItem,search:e.onSearch,select:e.onSelect},model:{value:e.inputValue,callback:function(t){e.inputValue=t},expression:"inputValue"}},[c("template",{slot:"input"},[c("SearchInput",{attrs:{placeholder:e.selectedSearchByItem.placeholder},on:{focus:function(t){e.isOpen=!0},input:function(t){return e.debouncedOnInput(t)},keyup:[function(t){e.isOpen=!0},function(t){if(!t.type.indexOf("key")&&e._k(t.keyCode,"esc",27,t.key,["Esc","Escape"]))return null;e.isOpen=!1}]},model:{value:e.inputValue,callback:function(t){e.inputValue=t},expression:"inputValue"}},[e.context?c("div",{attrs:{slot:"chip"},slot:"chip"},[e.context.is_global?[c("div",{staticClass:"context-chip m-all-contexts",on:{click:function(t){return e.changeShowContextPopup(!0)}}},[e._v("\n              Все разделы\n              "),c("OzonIcon",{staticClass:"context-chip-icon",attrs:{icon:n("8ca41d"),height:"16",width:"16"}})],1)]:[c("div",{staticClass:"context-chip"},[c("span",{staticClass:"context-title",attrs:{title:e.contextTitle}},[e._v("\n                "+e._s(e.contextTitle)+"\n              ")]),e._v(" "),c("span",{staticClass:"context-close-wrapper",on:{click:e.disableContext}},[c("OzonIcon",{staticClass:"context-close",attrs:{icon:n("b1e6ab"),height:"16",width:"16"}})],1)])]],2):e._e()])],1),e._v(" "),e.suggestionsEnabled?c("div",{attrs:{slot:"suggs"},slot:"suggs"},[c("TransitionFade",[c("div",{directives:[{name:"show",rawName:"v-show",value:e.isOpen,expression:"isOpen"}],class:["suggestions",{"m-mobile":e.isMobile}]},[c("PlaceholderRender",{attrs:{placeholders:e.suggsPlaceholders}})],1)])],1):e._e()],2),e._v(" "),c("div",{class:["search-button-wrap",{"m-mobile":e.isMobile}],on:{click:e.onClickSearchBtn}},[c("OzonButton",{staticClass:"m-search",attrs:{"data-test-id":"header-search-go",flat:""}})],1)],1)}),[],!1,null,"39e78ded",null));t.default=P.exports},c99850:function(e,t,n){"use strict";var c=n("90cfce");n.n(c).a},c9dfce:function(e,t,n){e.exports={"popup-wrapper":"fe0143","popup-mask":"_96cafa","popup-content-container":"_36c104","popup-close":"ccbab7",":hover":"_50aab5",blink:"f259ba"}},f9dfc6:function(e,t,n){"use strict";var c=n("c9dfce"),o=n.n(c);t.default=o.a}}]);